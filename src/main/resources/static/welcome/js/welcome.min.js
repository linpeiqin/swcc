var myChart;layui.config({base:ctx+"/common/echarts/"}).extend({echarts:"echarts.min"}).use(["layer","echarts"],function(){let layer=layui.layer;let echarts=layui.echarts;$.ajax({url:"/wc/wcInfo/wcInfoForState",type:"get",dataType:"json",success:function(a){initPage(a,echarts)},error:function(a){layer.msg("请求失败")}})});function initPage(b,a){let xAxisData=new Array();let dataMaps=new Array();let dataMapIndex=0;let wcInfos=new Array();myChart=a.init(document.getElementById("chart"));for(let i=0;i<b.data.length;i++){let info=b.data[i];initBrief(info);$.ajax({url:"/wc/setData/getTotalUsage",type:"get",dataType:"json",data:{wcId:info.wcInfoVo.wcId,macCode:info.wcInfoVo.macCode,day:6},success:function(c){let tempList=new Array();$.each(c.data,function(d,e){xAxisData[d]=e.date;tempList[d]=e.number});wcInfos[dataMapIndex]=info.info;dataMaps[dataMapIndex]={name:info.wcInfoVo.info,type:"line",smooth:true,itemStyle:{normal:{areaStyle:{type:"default"},color:"rgb("+Math.random()*255+", "+Math.random()*255+", "+Math.random()*255+")"}},data:tempList};dataMapIndex=dataMapIndex+1;updateCharts(xAxisData,dataMaps,wcInfos)},error:function(c){layer.msg("请求失败")}})}}function initBrief(a){$("#wcBrief").append('<li class="col-sm-12 col-md-6 col-xs-12"><a href="/wc/wcInfo/largeScreen?wcInfoId='+a.wcInfoVo.id+'" target=\'_blank\' class="clearfix"><div class="icon-bg bg-org f-l"><span class="iconfont">&#xe606;</span></div><div class="right-text-con"><p><span class="color-org">'+a.wcInfoVo.info+'</span><span class="color-org">('+a.wcInfoVo.statusName+')</span></p><p><span id="wcTotal'+a.wcInfoVo.wcIdAndMacCode+'">总人次：'+a.sumSetDataNumber+';</span><span id="wcLeft'+a.wcInfoVo.wcIdAndMacCode+'">总厕位：'+a.sumSetNumber+';</span></p><p><span id="wcLeft'+a.wcInfoVo.wcIdAndMacCode+'">男厕位：'+a.sumManSetNumber+';</span><span id="wcLeft'+a.wcInfoVo.wcIdAndMacCode+'">女厕位：'+a.sumWomanSetNumber+";</span></p></div></a></li>")}function updateCharts(b,a,c){myChart.setOption({title:{text:"近七天使用次数统计",textStyle:{color:"rgb(85, 85, 85)",fontSize:18,fontStyle:"normal",fontWeight:"normal"}},tooltip:{trigger:"axis"},legend:{data:c,selectedMode:false},toolbox:{show:true,feature:{dataView:{show:false,readOnly:true},magicType:{show:false,type:["line","bar","stack","tiled"]},restore:{show:true},saveAsImage:{show:true},mark:{show:false}}},xAxis:{type:"category",boundaryGap:false,data:b},yAxis:{type:"value"},series:a})}window.onresize=function(){myChart.resize()};