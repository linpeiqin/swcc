let tableIns;let util;let myChart;layui.config({base:ctx+"/common/echarts/"}).extend({echarts:"echarts.min"}).use(["util","element","form","table","layer","laydate","echarts"],function(){let table=layui.table;let laydate=layui.laydate;let element=layui.element;util=layui.util;let form=layui.form;let echarts=layui.echarts;tableIns=table.render({elem:"#waterUsageTable",url:ctx+"/wc/waterUsage/list",method:"POST",title:"用水信息",height:"full-180",cellMinWidth:200,page:false,cols:[[{field:"sortNumber",title:"序号",type:"numbers"},{field:"id",title:"记录日期",templet:function(a){return util.toDateString(a.id*1000*60*60*24,"yyyy-MM-dd")}},{field:"val",title:"水表读数",sort:true}]],response:{statusName:"flag",statusCode:true,msgName:"msg",countName:"records",dataName:"rows"},parseData:function(a){var b=a.data;return{flag:a.flag,msg:a.msg,records:b.length,rows:b}},done:function(a,c,b){reloadChart(a,c,b,echarts)}});initSelect(form);$("#rqueryButton").click(function(){let wcId=$("#wcSelector").val().split("|")[0]?$("#wcSelector").val().split("|")[0]:null;let macCode=$("#wcSelector").val().split("|")[1]?$("#wcSelector").val().split("|")[1]:null;let sd=new Date($("#startDatePicker").val());let ed=new Date($("#endDatePicker").val());let startDate="";let endDate="";if(!isNaN(sd)){startDate=sd.getTime(sd)/1000/60/60/24}if(!isNaN(ed)){endDate=ed.getTime(ed)/1000/60/60/24}let query={};query.where={macCode:macCode,wcId:wcId,startDate:startDate,endDate:endDate};tableIns.reload(query);return false});laydate.render({elem:"#startDatePicker",theme:"#8470FF"});laydate.render({elem:"#endDatePicker",theme:"#8470FF"});element.on("tab(waterUsageTabFilter)",function(){if(this.getAttribute("lay-id")=="chartLi"){myChart.resize({width:$("#chart-panel").width(),height:$("#chart-panel").height()})}})});function reloadChart(b,e,d,c){let dateList=new Array();let usageList=new Array();let dataList=new Array();let temp=0;for(var a=0;a<d;a++){let row=b.rows[a];temp=row.val-temp;dateList[a]=util.toDateString(row.id*1000*60*60*24,"yyyy-MM-dd");usageList[a]=row.val;dataList[a]=temp;temp=row.val}initChart(dateList,usageList,dataList,c)}function initChart(d,a,b,c){myChart=c.init(document.getElementById("chart"));myChart.setOption({title:{text:"数据统计",textStyle:{color:"rgb(85, 85, 85)",fontSize:18,fontStyle:"normal",fontWeight:"normal"}},tooltip:{trigger:"axis"},legend:{data:["用水量","水表读数"],selectedMode:false},toolbox:{show:true,feature:{dataView:{show:false,readOnly:true},magicType:{show:false,type:["line","bar","stack","tiled"]},restore:{show:true},saveAsImage:{show:true},mark:{show:false}}},calculable:false,xAxis:[{type:"category",boundaryGap:false,data:d}],yAxis:[{type:"value"}],grid:{x2:30,x:50},series:[{name:"用水量",type:"line",smooth:true,itemStyle:{normal:{areaStyle:{type:"default"}}},data:a},{name:"水表读数",type:"line",smooth:true,itemStyle:{normal:{areaStyle:{type:"default"}}},data:b}]})}window.onresize=function(){myChart.resize({width:$("#chart-panel").width(),height:$("#chart-panel").height()})};